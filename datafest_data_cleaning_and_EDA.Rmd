---
title: "Data aggregation, cleaning, and EDA"
date: "April 14th 2020"
output: html_notebook
---

```{r setup, include=FALSE}
library(fs) #file utils
library(lubridate) # date utils 
library(DT) # pretty interactive data tables
library(tidyverse)
```

## Datasets used: 

(Obviously can be adjusted)

Arizona: 
- PM 2.5 data for 2020 
- Carbon Monoxide data for 2020
- Covid cases by county

California:
- PM 2.5 data for 2020 
- Carbon Monoxide data for 2020
- Covid cases by county

Note. According to [this site](covid19.healthdata.org), California's stay at home order was March 19th, 2020. 

```{r datasets}
data_directory <- "/Users/oana/Documents/github/duke_datafest_covid19/datasets"

# Arizona EPA data
az_files <- fs::dir_ls(data_directory, regexp = "ad_viz_plotval_data_AZ*")
az_df <- az_files %>% 
  map(read_csv) %>% 
  map(~ .x %>% 
        mutate_if(is.character, toupper)) %>% 
  reduce(full_join, 
         by=c("Date","STATE_CODE", "STATE", "COUNTY_CODE", "COUNTY", "Site ID", "Site Name", "SITE_LATITUDE", "SITE_LONGITUDE", "CBSA_CODE", "CBSA_NAME"), 
         suffix = c("_co", "_pm25"))

# California EPA data 
ca_files <- fs::dir_ls(data_directory, regexp = "ad_viz_plotval_data_CA*")
ca_df <- ca_files %>% 
  map(read_csv) %>% 
  map(~ .x %>% 
        mutate_if(is.character, toupper)) %>% 
  reduce(full_join, 
         by=c("Date","STATE_CODE", "STATE", "COUNTY_CODE", "COUNTY", "Site ID", "Site Name", "SITE_LATITUDE", "SITE_LONGITUDE", "CBSA_CODE", "CBSA_NAME"), 
         suffix = c("_co", "_pm25"))


# Covid data from NYT: https://github.com/nytimes/covid-19-data 
covid_by_county_url <- "https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv"
covid_by_county_df <- read_csv(url(covid_by_county_url)) %>% 
  filter(state %in% c("California", "Arizona")) 
```

Look @ data sets:

```{r}

```


```{r}
datatable(covid_by_county_df, filter="top", 
          caption="COVID Confirmed Cases & Deaths for AZ & CA")
```


## Data cleaning 


## Exploratory Data Analysis (EDA)